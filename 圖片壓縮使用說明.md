# 📸 圖片壓縮工具使用說明

## 🎯 功能說明

自動壓縮 `images/` 資料夾中的所有圖片，加速網頁載入速度。

---

## ✨ 特色

- ✅ **自動掃描**：掃描所有子資料夾的圖片
- ✅ **智能壓縮**：PNG 和 JPG 分別使用最佳算法
- ✅ **自動備份**：原始圖片自動備份到 `backup/` 資料夾
- ✅ **安全保護**：只有在壓縮後更小時才替換
- ✅ **尺寸限制**：自動縮小超過 1920x1920 的圖片
- ✅ **詳細報告**：顯示每個檔案的壓縮結果

---

## 📊 當前狀態

**找到 42 個圖片檔案**，包括：
- 封面圖片（各頁面）
- 商品圖片
- 內容圖片
- Logo 圖片

---

## 🚀 快速開始

### 方法 1：使用批次檔（推薦）⭐

1. **雙擊執行**
   ```
   壓縮圖片.bat
   ```

2. **等待安裝 Sharp**（首次使用）
   - 會自動安裝必要套件
   - 大約需要 1-2 分鐘

3. **確認開始**
   - 按任意鍵開始壓縮

4. **等待完成**
   - 顯示每個檔案的處理進度
   - 完成後顯示統計資料

---

### 方法 2：手動執行

#### Step 1：安裝 Sharp
```bash
npm install sharp
```

#### Step 2：執行壓縮
```bash
node compress-images-with-sharp.js
```

---

## ⚙️ 壓縮設定

### 當前配置
```javascript
{
    quality: 80,         // 壓縮品質 (1-100)
    maxWidth: 1920,      // 最大寬度
    maxHeight: 1920,     // 最大高度
    backup: true         // 是否備份原始檔案
}
```

### 修改設定
如需調整，編輯 `compress-images-with-sharp.js` 第 18-22 行：

```javascript
const config = {
    quality: 85,          // 提高品質
    maxWidth: 2560,       // 增加最大寬度
    maxHeight: 2560,      // 增加最大高度
    backup: true
};
```

---

## 📁 檔案結構

### 壓縮前
```
images/
├── pages/
│   ├── about/
│   │   └── 關於我們封面.png  (1.2 MB)
│   └── ...
└── products/
    └── murcott/
        └── 茂谷柑1.png  (800 KB)
```

### 壓縮後
```
images/
├── pages/
│   ├── about/
│   │   ├── backup/
│   │   │   └── 關於我們封面.png  (1.2 MB) ← 原始備份
│   │   └── 關於我們封面.png  (450 KB) ← 壓縮版本
│   └── ...
└── products/
    └── murcott/
        ├── backup/
        │   └── 茂谷柑1.png  (800 KB)
        └── 茂谷柑1.png  (320 KB)
```

---

## 📊 預期效果

### 壓縮率（估算）

| 檔案類型 | 原始大小 | 壓縮後 | 節省 |
|---------|---------|--------|------|
| PNG（封面） | 1-2 MB | 400-800 KB | 50-60% |
| PNG（商品） | 500KB-1MB | 200-400 KB | 50-60% |
| JPG（照片） | 800KB-1.5MB | 300-600 KB | 60-70% |

### 整體效益
- 💾 **節省空間**：預計減少 50-70% 的檔案大小
- ⚡ **加速載入**：頁面載入時間減少 40-60%
- 📱 **行動優化**：手機用戶體驗大幅提升

---

## 🔄 處理流程

```
1. 掃描圖片
   ↓
2. 為每個圖片創建備份
   ↓
3. 壓縮並調整尺寸
   ↓
4. 比較檔案大小
   ↓
5. 僅在更小時替換
   ↓
6. 顯示統計報告
```

---

## ✅ 執行結果範例

```
===================================
   圖片壓縮工具 (使用 Sharp)
===================================

找到 42 個圖片檔案

開始壓縮...

✓ images/pages/about/covers/關於我們的封面首頁.png
  1.25 MB → 485 KB (節省 61.2%)

✓ images/products/murcott/gallery/茂谷柑1.png
  856 KB → 342 KB (節省 60.0%)

⊙ images/shared/logo/柑心商標.png
  已經是最佳大小 (175 KB)

...

===================================
壓縮完成！
===================================
處理檔案: 42/42
原始大小: 45.6 MB
壓縮後: 18.3 MB
節省空間: 27.3 MB (59.9%)

✓ 原始檔案已備份到各資料夾的 backup 子資料夾
===================================
```

---

## 🛡️ 安全機制

### 1. 自動備份
- 原始檔案自動備份
- 備份位置：每個資料夾的 `backup/` 子資料夾
- 不會重複備份（已存在則跳過）

### 2. 智能比較
- 只有在壓縮後更小時才替換
- 如果壓縮後反而更大，保留原檔案

### 3. 錯誤處理
- 單個檔案失敗不影響其他檔案
- 顯示詳細錯誤訊息

---

## 🔧 進階選項

### 僅掃描不壓縮
```bash
node compress-images.js
```
顯示所有圖片及大小，不執行壓縮。

### 還原備份
如果需要還原原始圖片：
```bash
# 手動從 backup 資料夾複製回來
# 或刪除壓縮版本，重命名備份檔案
```

---

## 📝 注意事項

### ⚠️ 執行前
- 確保有足夠的磁碟空間（至少 2 倍圖片總大小）
- 建議先在測試資料夾試用
- 重要圖片建議手動額外備份

### ⚠️ 執行後
- 檢查網頁圖片顯示是否正常
- 比較壓縮前後的視覺品質
- 如有問題，可從 backup 還原

### ⚠️ 品質設定
- 80% 是品質與大小的最佳平衡點
- 建議不要低於 70%（會明顯降低品質）
- 不要超過 90%（檔案太大）

---

## 🎓 技術細節

### 使用的技術
- **Sharp**：高效能的 Node.js 圖片處理庫
- **PNG 壓縮**：使用 pngquant 算法
- **JPG 壓縮**：使用 MozJPEG 算法

### 支援格式
- ✅ PNG
- ✅ JPG / JPEG
- ❌ GIF（不建議壓縮動畫）
- ❌ SVG（向量圖不需壓縮）
- ❌ WebP（已經是高效格式）

---

## 📈 效能提升

### 預期改善

| 項目 | 改善幅度 |
|------|---------|
| 首頁載入時間 | ↓ 40-60% |
| 圖片載入時間 | ↓ 50-70% |
| 行動數據用量 | ↓ 50-70% |
| SEO 分數 | ↑ 10-20分 |

---

## 🆘 常見問題

### Q: 壓縮後圖片模糊？
**A:** 提高 `quality` 設定（例如 85 或 90）

### Q: 某些圖片沒有被壓縮？
**A:** 可能已經是最佳大小，腳本會自動跳過

### Q: 如何批次還原？
**A:** 執行以下命令（需自行創建腳本）
```bash
# 從所有 backup 資料夾還原
```

### Q: Sharp 安裝失敗？
**A:** 
1. 確認 Node.js 版本 >= 14
2. 嘗試：`npm install --platform=win32 sharp`
3. 或手動下載預編譯版本

---

## 📞 需要協助？

如有任何問題：
1. 檢查 Node.js 是否正確安裝
2. 確認有管理員權限
3. 查看錯誤訊息並回報

---

**立即執行，加速您的網站！** 🚀
