<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <!-- SEO Meta Tags -->
    <title>全部商品 - 柑心果園 | 新鮮椪柑、茂谷柑線上選購</title>
    <meta name="description" content="柑心果園全部商品，提供新鮮椪柑、茂谷柑等優質水果，產地直送，品質保證。">
    <meta name="keywords" content="柑心果園,椪柑,茂谷柑,水果,商品,線上購物,台中豐原,公老坪">
    <meta name="author" content="柑心果園 Ganxin Orchard">
    <meta name="robots" content="index, follow">
    <link rel="stylesheet" href="./css/main.css?v=20251023">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="header-container"></div>
    <div id="mobile-menu-container"></div>

    <main id="main-content">
    <section class="hero-slider">
        <div class="slider-container">
            <div class="slide active">
                <img src="images/柑心果園販賣所-2.png" alt="柑心果園全部商品" fetchpriority="high" onerror="this.src='https://via.placeholder.com/1920x600/ff8c42/ffffff?text=全部商品'">
                <div class="slide-content">
                    <h1>全部商品</h1>
                    <p>精選優質農產品，產地直送，新鮮安心</p>
                    <a href="#main-content" class="btn-primary">立即選購</a>
                </div>
            </div>
        </div>
    </section>

    <!-- 商品頁面 -->
    <div class="products-page">
        <div class="products-header">
            <h1>全部商品</h1>
            <p>精選優質農產品，產地直送，新鮮安心</p>
        </div>

        <!-- 篩選區 -->
        <div class="filter-section">
            <div class="filter-group">
                <label class="filter-label">品種分類</label>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="category" data-value="全部">全部商品</button>
                    <button class="filter-btn" data-filter="category" data-value="優質水果">優質水果</button>
                    <button class="filter-btn" data-filter="category" data-value="新鮮蔬果">新鮮蔬果</button>
                    <button class="filter-btn" data-filter="category" data-value="冷凍食品">冷凍食品</button>
                </div>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">商品狀態</label>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="status" data-value="全部">全部狀態</button>
                    <button class="filter-btn" data-filter="status" data-value="現貨">現貨供應</button>
                    <button class="filter-btn" data-filter="status" data-value="預購">預購商品</button>
                </div>
            </div>
        </div>

        <!-- 商品數量 -->
        <div class="product-count">
            顯示 <span id="productCount">0</span> 項商品
        </div>

        <!-- 商品網格 -->
        <div class="products-grid" id="productsGrid">
            <!-- 商品將由 JavaScript 動態載入 -->
        </div>

        <!-- 無商品提示 -->
        <div class="no-products" id="noProducts" style="display: none;">
            <i class="fas fa-box-open"></i>
            <h3>沒有符合條件的商品</h3>
            <p>請嘗試調整篩選條件</p>
        </div>
    </div>
    </main>

    

    <!-- 商品頁腳本 -->
    <script src="./js/products.js?v=20250110"></script>
    <script>
        // 篩選功能
        let currentFilters = {
            category: '全部',
            status: '全部'
        };

        // 渲染商品
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            const noProducts = document.getElementById('noProducts');
            const productCount = document.getElementById('productCount');
            
            // 篩選商品
            let filteredProducts = products.filter(product => {
                let matchCategory = currentFilters.category === '全部' || product.category === currentFilters.category;
                let matchStatus = currentFilters.status === '全部' || 
                                 (currentFilters.status === '預購' && product.isPreorder) ||
                                 (currentFilters.status === '現貨' && !product.isPreorder);
                
                return matchCategory && matchStatus;
            });
            
            // 更新商品數量
            productCount.textContent = filteredProducts.length;
            
            // 顯示商品或無商品提示
            if (filteredProducts.length === 0) {
                grid.style.display = 'none';
                noProducts.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            noProducts.style.display = 'none';
            
            // 渲染商品卡片
            // 檢查是否有商品數據
            if (!filteredProducts || filteredProducts.length === 0) {
                console.error('沒有商品數據！');
                grid.style.display = 'none';
                noProducts.style.display = 'block';
                return;
            }
            
            grid.innerHTML = filteredProducts.map(product => {
                // 確保必要欄位存在
                const productId = product.id || 0;
                const productName = product.name || '未命名商品';
                const productPrice = product.price || 0;
                const productImage = product.image || 'images/placeholder.jpg';
                const productDesc = product.description || '新鮮美味，產地直送，品質保證';
                const productBadge = product.badge || '';
                const productCategory = product.category || '';
                
                return `
                <a href="product-detail.html?id=${productId}" class="product-card" data-product-id="${productId}">
                    ${productBadge ? `<span class="product-badge">${productBadge}</span>` : ''}
                    ${productCategory ? `<span class="product-category">${productCategory}</span>` : ''}
                    <div class="product-image">
                        <img src="${productImage}" 
                             alt="${productName}" 
                             loading="lazy" 
                             onerror="console.error('圖片載入失敗:', this.src); this.src='images/placeholder.jpg'; this.onerror=null;">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">${productName}</h3>
                        <p class="product-description">${productDesc}</p>
                        <div class="product-price">${productPrice.toLocaleString()}</div>
                    </div>
                </a>
                `;
            }).join('');
            
            // 確認渲染完成
            console.log('商品渲染完成，共', filteredProducts.length, '個商品');
        }
        
        // 檢查商品數據是否載入
        console.log('檢查商品數據:', typeof products !== 'undefined' ? products.length + '個商品' : '商品數據未載入！');
        
        // 篩選按鈕事件
        document.addEventListener('DOMContentLoaded', () => {
            // 二次檢查
            if (typeof products === 'undefined') {
                console.error('products.js 未正確載入！');
                document.getElementById('noProducts').style.display = 'block';
                document.getElementById('noProducts').innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>商品數據載入失敗</h3>
                    <p>請檢查 js/products.js 檔案是否存在</p>
                `;
                return;
            }
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filterType = this.dataset.filter;
                    const filterValue = this.dataset.value;
                    
                    // 更新按鈕狀態
                    document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // 更新篩選條件
                    currentFilters[filterType] = filterValue;
                    
                    // 重新渲染
                    renderProducts();
                });
            });

            // 初始化渲染
            renderProducts();
        });
    </script>

    <!-- Footer -->
    <!-- 頁尾 -->

    

    <!-- ??? -->
    
    <div id="footer-container"></div>

    <script src="./js/template-loader.js"></script>
    <script src="./js/mobile-menu-simple.js" defer></script>
    <script src="./js/dropdown-menu.js" defer></script>
    <script src="./js/cart.js" defer></script>
    <script src="./js/main.js" defer></script>
</body>
</html>


