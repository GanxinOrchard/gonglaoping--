<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³¼ç‰©è»Šèª¿è©¦å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #e55a25;
        }
        .log {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .log-item {
            margin: 3px 0;
            padding: 3px 0;
            border-bottom: 1px solid #333;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 10px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-ok { background: #4ade80; color: white; }
        .status-fail { background: #f87171; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ›’ è³¼ç‰©è»ŠåŠŸèƒ½èª¿è©¦å·¥å…·</h1>
    
    <div class="test-section">
        <h2>1. å‡½æ•¸å¯ç”¨æ€§æ¸¬è©¦</h2>
        <button onclick="testFunctions()">æª¢æŸ¥æ‰€æœ‰å‡½æ•¸</button>
        <div id="functionTest" class="log"></div>
    </div>

    <div class="test-section">
        <h2>2. æ·»åŠ æ¸¬è©¦å•†å“</h2>
        <button onclick="addTestProduct()">æ·»åŠ æ¸¬è©¦å•†å“åˆ°è³¼ç‰©è»Š</button>
        <button onclick="clearCart()">æ¸…ç©ºè³¼ç‰©è»Š</button>
        <div id="addTest" class="log"></div>
    </div>

    <div class="test-section">
        <h2>3. æŸ¥çœ‹è³¼ç‰©è»Šå…§å®¹</h2>
        <button onclick="viewCart()">æŸ¥çœ‹è³¼ç‰©è»Šæ•¸æ“š</button>
        <div id="cartView" class="log"></div>
    </div>

    <div class="test-section">
        <h2>4. æ¸¬è©¦æŒ‰éˆ•åŠŸèƒ½</h2>
        <button onclick="testUpdateQuantity()">æ¸¬è©¦æ•¸é‡èª¿æ•´</button>
        <button onclick="testRemoveItem()">æ¸¬è©¦åˆªé™¤å•†å“</button>
        <div id="buttonTest" class="log"></div>
    </div>

    <div class="test-section">
        <h2>5. å‰å¾€è³¼ç‰©è»Šé é¢</h2>
        <button onclick="window.location.href='cart.html'">æ‰“é–‹è³¼ç‰©è»Šé é¢</button>
        <button onclick="window.open('cart.html', '_blank')">æ–°è¦–çª—æ‰“é–‹è³¼ç‰©è»Š</button>
    </div>

    <script>
        function log(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `log-item ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function testFunctions() {
            const containerId = 'functionTest';
            document.getElementById(containerId).innerHTML = '';
            
            log(containerId, 'é–‹å§‹æª¢æŸ¥å‡½æ•¸...', 'info');
            
            const functions = [
                'updateCartQuantity',
                'removeCartItem', 
                'addToCart',
                'updateCartCount',
                'renderCartItems'
            ];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(containerId, `âœ… ${funcName} - å¯ç”¨`, 'success');
                } else if (typeof eval(funcName) === 'function') {
                    log(containerId, `âš ï¸  ${funcName} - å­˜åœ¨ä½†ä¸åœ¨ window å°è±¡`, 'warning');
                } else {
                    log(containerId, `âŒ ${funcName} - ä¸å¯ç”¨`, 'error');
                }
            });
            
            log(containerId, 'æª¢æŸ¥å®Œæˆï¼', 'info');
        }

        function addTestProduct() {
            const containerId = 'addTest';
            document.getElementById(containerId).innerHTML = '';
            
            const testProduct = {
                id: 999,
                name: 'æ¸¬è©¦å•†å“ - æ±å‹¢èŒ‚è°·æŸ‘',
                price: 880,
                image: 'images/products/murcott/gallery/èŒ‚è°·æŸ‘1.png',
                selectedSpec: '23A (æ¸¬è©¦è¦æ ¼)',
                selectedSpecId: 'TEST-23A',
                shippingType: 'normal',
                quantity: 1
            };
            
            log(containerId, 'æº–å‚™æ·»åŠ æ¸¬è©¦å•†å“...', 'info');
            log(containerId, JSON.stringify(testProduct, null, 2), 'info');
            
            try {
                if (typeof window.addToCart === 'function') {
                    window.addToCart(testProduct);
                    log(containerId, 'âœ… å•†å“å·²æ·»åŠ ï¼', 'success');
                    log(containerId, 'è«‹æ‰“é–‹è³¼ç‰©è»Šé é¢æŸ¥çœ‹æ•ˆæœ', 'info');
                } else {
                    log(containerId, 'âŒ addToCart å‡½æ•¸ä¸å¯ç”¨', 'error');
                }
            } catch (e) {
                log(containerId, `âŒ éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        function clearCart() {
            const containerId = 'addTest';
            try {
                localStorage.removeItem('ganxin_cart');
                localStorage.removeItem('cart');
                log(containerId, 'âœ… è³¼ç‰©è»Šå·²æ¸…ç©º', 'success');
            } catch (e) {
                log(containerId, `âŒ éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        function viewCart() {
            const containerId = 'cartView';
            document.getElementById(containerId).innerHTML = '';
            
            log(containerId, 'è®€å–è³¼ç‰©è»Šæ•¸æ“š...', 'info');
            
            try {
                const cart1 = localStorage.getItem('ganxin_cart');
                const cart2 = localStorage.getItem('cart');
                
                log(containerId, `ganxin_cart: ${cart1 ? 'æœ‰æ•¸æ“š' : 'ç„¡æ•¸æ“š'}`, cart1 ? 'success' : 'warning');
                if (cart1) {
                    const parsed = JSON.parse(cart1);
                    log(containerId, `å•†å“æ•¸é‡: ${parsed.length}`, 'info');
                    parsed.forEach((item, index) => {
                        log(containerId, `å•†å“ ${index + 1}: ${item.name} x${item.quantity} (è¦æ ¼: ${item.selectedSpec || 'ç„¡'})`, 'info');
                    });
                }
                
                log(containerId, `cart: ${cart2 ? 'æœ‰æ•¸æ“š' : 'ç„¡æ•¸æ“š'}`, cart2 ? 'success' : 'warning');
                
            } catch (e) {
                log(containerId, `âŒ éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        function testUpdateQuantity() {
            const containerId = 'buttonTest';
            document.getElementById(containerId).innerHTML = '';
            
            log(containerId, 'æ¸¬è©¦æ•¸é‡èª¿æ•´åŠŸèƒ½...', 'info');
            
            try {
                const cart = JSON.parse(localStorage.getItem('ganxin_cart') || '[]');
                if (cart.length === 0) {
                    log(containerId, 'âš ï¸  è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆæ·»åŠ å•†å“', 'warning');
                    return;
                }
                
                const item = cart[0];
                log(containerId, `æ¸¬è©¦å•†å“: ${item.name}`, 'info');
                log(containerId, `ç•¶å‰æ•¸é‡: ${item.quantity}`, 'info');
                
                if (typeof window.updateCartQuantity === 'function') {
                    window.updateCartQuantity(item.id, 1, item.selectedSpecId);
                    log(containerId, 'âœ… åŸ·è¡Œ +1 æˆåŠŸ', 'success');
                    
                    const updatedCart = JSON.parse(localStorage.getItem('ganxin_cart') || '[]');
                    const updatedItem = updatedCart.find(i => i.id === item.id);
                    log(containerId, `æ›´æ–°å¾Œæ•¸é‡: ${updatedItem ? updatedItem.quantity : 'æ‰¾ä¸åˆ°'}`, updatedItem ? 'success' : 'error');
                } else {
                    log(containerId, 'âŒ updateCartQuantity å‡½æ•¸ä¸å¯ç”¨', 'error');
                }
            } catch (e) {
                log(containerId, `âŒ éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        function testRemoveItem() {
            const containerId = 'buttonTest';
            
            log(containerId, 'æ¸¬è©¦åˆªé™¤åŠŸèƒ½...', 'info');
            
            try {
                const cart = JSON.parse(localStorage.getItem('ganxin_cart') || '[]');
                if (cart.length === 0) {
                    log(containerId, 'âš ï¸  è³¼ç‰©è»Šæ˜¯ç©ºçš„', 'warning');
                    return;
                }
                
                const item = cart[cart.length - 1];
                log(containerId, `æº–å‚™åˆªé™¤: ${item.name}`, 'info');
                
                if (typeof window.removeCartItem === 'function') {
                    window.removeCartItem(item.id, item.selectedSpecId);
                    log(containerId, 'âœ… åˆªé™¤æˆåŠŸ', 'success');
                    
                    const updatedCart = JSON.parse(localStorage.getItem('ganxin_cart') || '[]');
                    log(containerId, `å‰©é¤˜å•†å“æ•¸é‡: ${updatedCart.length}`, 'info');
                } else {
                    log(containerId, 'âŒ removeCartItem å‡½æ•¸ä¸å¯ç”¨', 'error');
                }
            } catch (e) {
                log(containerId, `âŒ éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.onload = function() {
            setTimeout(testFunctions, 500);
        };
    </script>
</body>
</html>
