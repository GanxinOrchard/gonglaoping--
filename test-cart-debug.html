<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>購物車功能測試</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: white;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 8px;
            z-index: 99999;
            max-width: 400px;
            font-size: 14px;
        }
        .debug-panel h3 {
            margin: 0 0 10px 0;
            color: #ff8c42;
        }
        .debug-item {
            margin: 5px 0;
            padding: 5px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .ok { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h3>🔍 購物車功能診斷</h3>
        <div id="debugOutput"></div>
        <button onclick="testCart()" style="margin-top: 10px; padding: 10px; background: #ff8c42; color: white; border: none; border-radius: 4px; cursor: pointer;">
            重新測試
        </button>
    </div>

    <!-- 懸浮購物車按鈕 -->
    <div class="floating-cart-btn" id="floatingCartBtn">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-badge" id="floatingCartCount">0</span>
    </div>

    <!-- 購物車側邊欄 -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>購物車</h3>
            <button class="close-cart" id="closeCart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cartItems">
            <p>購物車是空的</p>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <div class="total">
                    <span>總計：</span>
                    <span id="total">NT$ 0</span>
                </div>
            </div>
            <button class="btn-checkout" id="checkoutBtn">前往結帳</button>
        </div>
    </div>

    <script src="./js/products.js"></script>
    <script src="./js/cart.js"></script>
    <script src="./js/main.js"></script>
    
    <script>
        function testCart() {
            const output = document.getElementById('debugOutput');
            let html = '';
            
            // 測試 1: 檢查元素
            html += '<div class="debug-item"><strong>1. 元素檢查：</strong><br>';
            const floatingCartBtn = document.getElementById('floatingCartBtn');
            const cartSidebar = document.getElementById('cartSidebar');
            const closeCart = document.getElementById('closeCart');
            
            html += floatingCartBtn ? '<span class="ok">✓ floatingCartBtn 存在</span><br>' : '<span class="error">✗ floatingCartBtn 不存在</span><br>';
            html += cartSidebar ? '<span class="ok">✓ cartSidebar 存在</span><br>' : '<span class="error">✗ cartSidebar 不存在</span><br>';
            html += closeCart ? '<span class="ok">✓ closeCart 存在</span><br>' : '<span class="error">✗ closeCart 不存在</span><br>';
            html += '</div>';
            
            // 測試 2: 檢查事件監聽器
            html += '<div class="debug-item"><strong>2. 事件監聽器：</strong><br>';
            if (floatingCartBtn) {
                const listeners = getEventListeners ? getEventListeners(floatingCartBtn) : null;
                html += listeners ? `<span class="ok">✓ 有事件監聽器</span><br>` : '<span>無法檢測事件監聽器（需要開發者工具）</span><br>';
            }
            html += '</div>';
            
            // 測試 3: 手動觸發
            html += '<div class="debug-item"><strong>3. 手動測試：</strong><br>';
            html += '<button onclick="manualOpenCart()" style="padding: 5px 10px; margin: 5px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">手動開啟購物車</button><br>';
            html += '</div>';
            
            // 測試 4: CSS 檢查
            html += '<div class="debug-item"><strong>4. CSS 狀態：</strong><br>';
            if (floatingCartBtn) {
                const style = window.getComputedStyle(floatingCartBtn);
                html += `display: ${style.display}<br>`;
                html += `visibility: ${style.visibility}<br>`;
                html += `z-index: ${style.zIndex}<br>`;
                html += `position: ${style.position}<br>`;
            }
            html += '</div>';
            
            // 測試 5: JavaScript 錯誤
            html += '<div class="debug-item"><strong>5. 控制台訊息：</strong><br>';
            html += '請打開瀏覽器控制台 (F12) 查看錯誤訊息';
            html += '</div>';
            
            output.innerHTML = html;
        }
        
        function manualOpenCart() {
            const cartSidebar = document.getElementById('cartSidebar');
            if (cartSidebar) {
                cartSidebar.classList.add('active');
                alert('購物車已開啟！如果看不到，可能是 CSS 問題。');
            } else {
                alert('找不到購物車元素！');
            }
        }
        
        // 頁面載入後自動測試
        window.addEventListener('load', () => {
            setTimeout(testCart, 1000);
        });
        
        // 監聽點擊事件
        document.addEventListener('click', (e) => {
            console.log('點擊事件:', e.target);
            if (e.target.closest('#floatingCartBtn')) {
                console.log('點擊了懸浮購物車按鈕');
            }
        }, true);
    </script>
</body>
</html>
