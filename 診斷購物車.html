<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³¼ç‰©è»Šè¨ºæ–·å·¥å…·</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #ff8c42;
            margin-top: 0;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .ok {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        button {
            background: #ff8c42;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e67e22;
        }
        .floating-cart-btn {
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            width: 60px !important;
            height: 60px !important;
            background: var(--primary-color) !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            box-shadow: 0 4px 12px rgba(255, 140, 66, 0.4) !important;
            cursor: pointer !important;
            z-index: 50000 !important;
        }
    </style>
</head>
<body>
    <h1>ğŸ” è³¼ç‰©è»ŠåŠŸèƒ½è¨ºæ–·å·¥å…·</h1>
    
    <div class="test-section">
        <h2>1. JavaScript æª”æ¡ˆè¼‰å…¥æª¢æŸ¥</h2>
        <div id="jsCheck"></div>
    </div>

    <div class="test-section">
        <h2>2. DOM å…ƒç´ æª¢æŸ¥</h2>
        <div id="domCheck"></div>
    </div>

    <div class="test-section">
        <h2>3. äº‹ä»¶ç›£è½å™¨æ¸¬è©¦</h2>
        <div id="eventCheck"></div>
        <button onclick="testClickEvent()">æ¸¬è©¦é»æ“Šäº‹ä»¶</button>
    </div>

    <div class="test-section">
        <h2>4. æ‰‹å‹•æ¸¬è©¦</h2>
        <button onclick="manualOpenCart()">æ‰‹å‹•é–‹å•Ÿè³¼ç‰©è»Š</button>
        <button onclick="testAddToCart()">æ¸¬è©¦åŠ å…¥è³¼ç‰©è»Š</button>
        <div id="manualResult"></div>
    </div>

    <div class="test-section">
        <h2>5. æ§åˆ¶å°æ—¥èªŒ</h2>
        <div id="consoleLog" style="background: #f5f5f5; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
    </div>

    <!-- æ‡¸æµ®è³¼ç‰©è»ŠæŒ‰éˆ• -->
    <div class="floating-cart-btn" id="floatingCartBtn">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-badge" id="floatingCartCount">0</span>
    </div>

    <!-- è³¼ç‰©è»Šå´é‚Šæ¬„ -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>è³¼ç‰©è»Š</h3>
            <button class="close-cart" id="closeCart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cartItems">
            <p>è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <div class="total">
                    <span>ç¸½è¨ˆï¼š</span>
                    <span id="total">NT$ 0</span>
                </div>
            </div>
            <button class="btn-checkout" id="checkoutBtn">å‰å¾€çµå¸³</button>
        </div>
    </div>

    <script src="./js/products.js"></script>
    <script src="./js/cart.js"></script>
    <script src="./js/main.js"></script>
    
    <script>
        // æ””æˆª console.log
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('consoleLog');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logDiv.innerHTML += `<div style="color: #333;">[LOG] ${args.join(' ')}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logDiv.innerHTML += `<div style="color: #dc3545;">[ERROR] ${args.join(' ')}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        function checkJS() {
            const jsCheck = document.getElementById('jsCheck');
            let html = '';
            
            // æª¢æŸ¥ products
            if (typeof products !== 'undefined') {
                html += `<div class="result ok">âœ“ products.js å·²è¼‰å…¥ (${products.length} å€‹å•†å“)</div>`;
            } else {
                html += `<div class="result error">âœ— products.js æœªè¼‰å…¥æˆ– products è®Šæ•¸ä¸å­˜åœ¨</div>`;
            }
            
            // æª¢æŸ¥ cart ç›¸é—œå‡½æ•¸
            if (typeof addToCart === 'function') {
                html += `<div class="result ok">âœ“ addToCart å‡½æ•¸å­˜åœ¨</div>`;
            } else {
                html += `<div class="result error">âœ— addToCart å‡½æ•¸ä¸å­˜åœ¨</div>`;
            }
            
            if (typeof updateCartUI === 'function') {
                html += `<div class="result ok">âœ“ updateCartUI å‡½æ•¸å­˜åœ¨</div>`;
            } else {
                html += `<div class="result error">âœ— updateCartUI å‡½æ•¸ä¸å­˜åœ¨</div>`;
            }
            
            jsCheck.innerHTML = html;
        }

        function checkDOM() {
            const domCheck = document.getElementById('domCheck');
            let html = '';
            
            const elements = {
                'floatingCartBtn': document.getElementById('floatingCartBtn'),
                'cartSidebar': document.getElementById('cartSidebar'),
                'closeCart': document.getElementById('closeCart'),
                'cartItems': document.getElementById('cartItems'),
                'cartCount': document.getElementById('floatingCartCount')
            };
            
            for (const [name, element] of Object.entries(elements)) {
                if (element) {
                    const style = window.getComputedStyle(element);
                    html += `<div class="result ok">âœ“ ${name} å­˜åœ¨ (display: ${style.display}, visibility: ${style.visibility})</div>`;
                } else {
                    html += `<div class="result error">âœ— ${name} ä¸å­˜åœ¨</div>`;
                }
            }
            
            domCheck.innerHTML = html;
        }

        function testClickEvent() {
            const eventCheck = document.getElementById('eventCheck');
            const btn = document.getElementById('floatingCartBtn');
            
            if (btn) {
                eventCheck.innerHTML = '<div class="result warning">æ­£åœ¨æ¸¬è©¦é»æ“Šäº‹ä»¶...</div>';
                
                // æ¨¡æ“¬é»æ“Š
                btn.click();
                
                setTimeout(() => {
                    const sidebar = document.getElementById('cartSidebar');
                    if (sidebar && sidebar.classList.contains('active')) {
                        eventCheck.innerHTML = '<div class="result ok">âœ“ é»æ“Šäº‹ä»¶æ­£å¸¸ï¼è³¼ç‰©è»Šå·²é–‹å•Ÿ</div>';
                    } else {
                        eventCheck.innerHTML = '<div class="result error">âœ— é»æ“Šäº‹ä»¶ç„¡æ•ˆï¼Œè³¼ç‰©è»Šæœªé–‹å•Ÿ</div>';
                    }
                }, 500);
            } else {
                eventCheck.innerHTML = '<div class="result error">âœ— æ‰¾ä¸åˆ°è³¼ç‰©è»ŠæŒ‰éˆ•</div>';
            }
        }

        function manualOpenCart() {
            const result = document.getElementById('manualResult');
            const sidebar = document.getElementById('cartSidebar');
            
            if (sidebar) {
                sidebar.classList.add('active');
                result.innerHTML = '<div class="result ok">âœ“ è³¼ç‰©è»Šå·²æ‰‹å‹•é–‹å•Ÿ</div>';
            } else {
                result.innerHTML = '<div class="result error">âœ— æ‰¾ä¸åˆ°è³¼ç‰©è»Šå´é‚Šæ¬„</div>';
            }
        }

        function testAddToCart() {
            const result = document.getElementById('manualResult');
            
            if (typeof addToCart === 'function' && typeof products !== 'undefined' && products.length > 0) {
                try {
                    addToCart(products[0].id, null, 1);
                    result.innerHTML = '<div class="result ok">âœ“ æˆåŠŸåŠ å…¥è³¼ç‰©è»Šï¼</div>';
                } catch (error) {
                    result.innerHTML = `<div class="result error">âœ— åŠ å…¥è³¼ç‰©è»Šå¤±æ•—: ${error.message}</div>`;
                }
            } else {
                result.innerHTML = '<div class="result error">âœ— addToCart å‡½æ•¸æˆ–å•†å“è³‡æ–™ä¸å­˜åœ¨</div>';
            }
        }

        // é é¢è¼‰å…¥å¾ŒåŸ·è¡Œæª¢æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('é–‹å§‹è¨ºæ–·...');
                checkJS();
                checkDOM();
                console.log('è¨ºæ–·å®Œæˆ');
            }, 1000);
        });

        // ç›£è½æ‰€æœ‰é»æ“Šäº‹ä»¶
        document.addEventListener('click', (e) => {
            console.log('é»æ“Šäº‹ä»¶:', e.target.id || e.target.className || e.target.tagName);
        }, true);
    </script>
</body>
</html>
