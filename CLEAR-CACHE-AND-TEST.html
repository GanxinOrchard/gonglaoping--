<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>清除快取並測試 - 柑心果園</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff8c42;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #fff7ed;
            border-left: 4px solid #ff8c42;
            border-radius: 5px;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #ff8c42;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }
        .btn:hover {
            background: #e67a32;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            border-radius: 5px;
        }
        .error {
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 清除快取並測試</h1>
        
        <div class="step">
            <h3>步驟 1: 清除瀏覽器快取</h3>
            <p>請按以下快捷鍵清除快取：</p>
            <ul>
                <li><strong>Chrome/Edge</strong>: Ctrl + Shift + Delete</li>
                <li><strong>Firefox</strong>: Ctrl + Shift + Delete</li>
                <li>選擇「快取的圖片和檔案」</li>
                <li>時間範圍選「所有時間」</li>
                <li>點擊「清除資料」</li>
            </ul>
        </div>

        <div class="step">
            <h3>步驟 2: 強制重新整理</h3>
            <p>清除快取後，按 <code>Ctrl + F5</code> 強制重新整理頁面</p>
        </div>

        <div class="step">
            <h3>步驟 3: 自動清除快取</h3>
            <button class="btn" onclick="clearAllCache()">點擊清除所有快取</button>
            <p id="clearStatus"></p>
        </div>

        <div class="step">
            <h3>步驟 4: 測試功能</h3>
            <button class="btn" onclick="testCart()">測試購物車</button>
            <button class="btn" onclick="testProducts()">測試商品載入</button>
            <div id="testResults"></div>
        </div>

        <div class="step">
            <h3>步驟 5: 前往網站</h3>
            <a href="index.html" class="btn">前往首頁</a>
            <a href="https://ganxinorchard.github.io/gonglaoping--/" class="btn" target="_blank">前往線上網站</a>
        </div>

        <div class="step">
            <h3>🔍 除錯資訊</h3>
            <p>開啟瀏覽器控制台（F12）查看錯誤訊息</p>
            <button class="btn" onclick="showDebugInfo()">顯示除錯資訊</button>
            <div id="debugInfo"></div>
        </div>
    </div>

    <!-- 載入必要的 JS 檔案 -->
    <script src="./js/products.js"></script>
    <script src="./js/cart.js"></script>
    
    <script>
        // 清除所有快取
        function clearAllCache() {
            const statusEl = document.getElementById('clearStatus');
            
            try {
                // 清除 localStorage
                localStorage.clear();
                
                // 清除 sessionStorage
                sessionStorage.clear();
                
                // 清除 Service Worker 快取
                if ('caches' in window) {
                    caches.keys().then(function(names) {
                        for (let name of names) {
                            caches.delete(name);
                        }
                    });
                }
                
                statusEl.innerHTML = '<div class="status">✅ 快取已清除！請按 Ctrl+F5 重新整理頁面</div>';
                
                // 3秒後自動重新整理
                setTimeout(() => {
                    window.location.reload(true);
                }, 3000);
                
            } catch (error) {
                statusEl.innerHTML = '<div class="status error">❌ 清除失敗：' + error.message + '</div>';
            }
        }

        // 測試購物車
        function testCart() {
            const resultsEl = document.getElementById('testResults');
            let results = '<div class="status"><h4>購物車測試結果：</h4><ul>';
            
            // 檢查 cart.js 是否載入
            if (typeof addToCart === 'function') {
                results += '<li>✅ addToCart 函數存在</li>';
            } else {
                results += '<li>❌ addToCart 函數不存在</li>';
            }
            
            if (typeof cart !== 'undefined') {
                results += '<li>✅ cart 變數存在</li>';
            } else {
                results += '<li>❌ cart 變數不存在</li>';
            }
            
            if (typeof updateCartUI === 'function') {
                results += '<li>✅ updateCartUI 函數存在</li>';
            } else {
                results += '<li>❌ updateCartUI 函數不存在</li>';
            }
            
            results += '</ul></div>';
            resultsEl.innerHTML = results;
        }

        // 測試商品載入
        function testProducts() {
            const resultsEl = document.getElementById('testResults');
            let results = '<div class="status"><h4>商品測試結果：</h4><ul>';
            
            if (typeof products !== 'undefined') {
                results += '<li>✅ products 陣列存在</li>';
                results += '<li>商品數量：' + products.length + '</li>';
                
                products.forEach(p => {
                    results += '<li>商品 ' + p.id + ': ' + p.name + ' (運費類型: ' + p.shippingType + ')</li>';
                });
            } else {
                results += '<li>❌ products 陣列不存在</li>';
            }
            
            results += '</ul></div>';
            resultsEl.innerHTML = results;
        }

        // 顯示除錯資訊
        function showDebugInfo() {
            const debugEl = document.getElementById('debugInfo');
            let info = '<div class="status"><h4>系統資訊：</h4><ul>';
            
            info += '<li>瀏覽器：' + navigator.userAgent + '</li>';
            info += '<li>當前網址：' + window.location.href + '</li>';
            info += '<li>localStorage 項目數：' + localStorage.length + '</li>';
            info += '<li>sessionStorage 項目數：' + sessionStorage.length + '</li>';
            
            // 檢查是否有錯誤
            window.onerror = function(msg, url, line) {
                info += '<li class="error">❌ JavaScript 錯誤：' + msg + ' (行 ' + line + ')</li>';
            };
            
            info += '</ul></div>';
            debugEl.innerHTML = info;
        }

        // 自動檢查
        window.addEventListener('load', function() {
            console.log('=== 柑心果園除錯工具 ===');
            console.log('請點擊按鈕進行測試');
        });
    </script>
</body>
</html>
